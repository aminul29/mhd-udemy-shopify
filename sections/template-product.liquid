<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@latest/swiper-bundle.min.css" async />
<script src="https://cdn.jsdelivr.net/npm/swiper@latest/swiper-bundle.min.js" async></script>

{% assign selected_variant = product.selected_or_first_available_variant %}

<style>
  .swiper-button-next, .swiper-button-prev {
    @apply text-gray-800 bottom-2 h-8 w-8 bg-white/80 rounded-full shadow-md;
  }
  .swiper-button-next::after, .swiper-button-prev::after {
    @apply text-lg;
  }
  .swiper-pagination {
    @apply text-gray-800 bottom-0;
  }
  .swiper-pagination-bullet-active {
    @apply bg-gray-800;
  }
</style>

<section class="max-w-7xl mx-auto px-4 py-12">
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
    <!-- Product Gallery -->
    <div class="product--medias space-y-8">
      <!-- Desktop Gallery -->
      <div class="hidden md:grid grid-cols-1 gap-6">
        {% for media in product.media %}
          <div class="group relative overflow-hidden rounded-lg bg-gray-100 shadow-lg transition duration-300 ease-in-out hover:shadow-xl">
            <div class="aspect-square">
              {% render 'product-media', media: media %}
            </div>
          </div>
        {% endfor %}
      </div>
      
      <!-- Mobile Swiper -->
      <div class="md:hidden">
        <div class="swiper rounded-xl shadow-lg">
          <div class="swiper-wrapper">
            {% for media in product.media %}
              <div class="swiper-slide">
                <div class="aspect-square p-2">
                  {% render 'product-media', media:media %}
                </div>
              </div>
            {% endfor %}
          </div>
          <div class="swiper-pagination"></div>
          <div class="swiper-button-prev"></div>
          <div class="swiper-button-next"></div>
        </div>
      </div>
    </div>

    <!-- Product Information -->
    <div class="product--information sticky top-5 space-y-8 h-fit">
      {% form 'product', product, class: 'space-y-8' %}
        <input type="hidden" name="id" value="{{ selected_variant.id }}">
        
        <!-- Product Header -->
        <div class="space-y-4 border-b border-gray-200 pb-6">
          <span class="inline-block text-sm font-medium text-indigo-600">{{ product.vendor }}</span>
          <h1 class="text-4xl font-bold text-gray-900 tracking-tight">{{ product.title }}</h1>
          
          <!-- Price -->
          <div class="flex items-center gap-4">
            {% assign product_price = selected_variant %}
            <span class="text-3xl font-bold text-gray-900">{{ product_price.price | money }}</span>
            {% if selected_variant.price < selected_variant.compare_at_price %}
              <span class="text-lg text-gray-500 line-through">{{ product_price.compare_at_price | money }}</span>
              <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-medium">Sale</span>
            {% endif %}
          </div>
        </div>

        <!-- Variant Selector -->
        {% unless product.has_only_default_variant %}
          <div class="space-y-6" data-url="{{ product.url }}" data-section="{{ section.id }}">
            {% for option in product.options_with_values %}
              <div class="space-y-3">
                <label for="option-{{ section.id }}-{{ forloop.index0 }}" class="block text-sm font-medium text-gray-700">
                  {{ option.name }}
                </label>
                <select name="options[{{ option.name | escape }}]" 
                        id="option-{{ section.id }}-{{ forloop.index0 }}"
                        class="w-full rounded-lg border-gray-300 py-3 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                  {% for value in option.values %}
                    <option value="{{ value | escape }}"
                            {% if option.selected_value == value %}selected="selected"{% endif %}>
                      {{ value }}
                    </option>
                  {% endfor %}
                </select>
              </div>
            {% endfor %}
          </div>
        {% endunless %}

        <!-- Quantity Selector -->
        <div class="space-y-3">
          <label for="quantity-{{ section.id }}" class="block text-sm font-medium text-gray-700">Quantity</label>
          <input type="number" 
                 name="quantity" 
                 id="quantity-{{ section.id }}" 
                 value="1" 
                 min="1"
                 class="w-32 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
        </div>

        <!-- Description -->
        <div class="prose prose-sm max-w-none border-t border-gray-200 pt-6">
          <p class="text-gray-700">{{ product.description }}</p>
        </div>

        <!-- Add to Cart Button -->
        <button type="submit" 
                name="add"
                {% if selected_variant.available == false %}disabled{% endif %}
                class="w-full rounded-lg bg-indigo-600 px-6 py-4 text-base font-semibold text-white shadow-md transition duration-300 ease-in-out hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 disabled:opacity-50">
          {% if selected_variant.available == false %}
            Sold Out
          {% else %}
            Add to Cart
          {% endif %}
        </button>
      {% endform %}
    </div>
  </div>
</section>

<script>
  const swiper = new Swiper('.swiper', {
    direction: 'horizontal',
    pagination: {
      el: '.swiper-pagination'
    },
    navigation: {
      nextEl: '.swiper-button-next',
      prevEl: '.swiper-button-prev'
    },
  });
</script>